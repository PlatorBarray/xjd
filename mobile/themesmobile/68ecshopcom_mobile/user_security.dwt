<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="Keywords" content="{$keywords}" />
<meta name="Description" content="{$description}" />
<meta http-equiv="X-UA-Compatible" content="IE=EmulateIE7" />
<!-- TemplateBeginEditable name="doctitle" -->
<title>{$page_title}</title>
<!-- TemplateEndEditable -->
<!-- TemplateBeginEditable name="head" -->
<!-- TemplateEndEditable -->
<link rel="shortcut icon" href="favicon.ico" />
<link rel="icon" href="animated_favicon.gif" type="image/gif" />
<link rel="stylesheet" href="themesmobile/68ecshopcom_mobile/css/ecsmart.css" />
<script type="text/javascript" src="themesmobile/68ecshopcom_mobile/js/jquery.js"></script>
<script type="text/javascript" src="themesmobile/68ecshopcom_mobile/js/validate/jquery.validate.js"></script>
<script type="text/javascript" src="themesmobile/68ecshopcom_mobile/js/validate/messages_zh.js"></script>
{insert_scripts files='common.js,utils.js,user.js,transport.js'}
</head>
<body>
<header id="header" class='header'>
  <h1> 账户安全 </h1>
  <a href="security.php" class="back">返回</a>
</header>
<div id="tbh5v0">
  <div class="screen-wrap fullscreen login">
    <section class="">
        <!-- 账户中心首页 start --> 
        <!-- {if $action eq 'account_security'} -->
        <div class="s_b border-bt">
          <h5 class="user-title user-title-t"> 
          	<p> <span class="span_rank">安全级别： 
          {if $info.is_validated eq 0 && $info.validated eq 0 && $info.is_surplus_open eq 0}很危险&nbsp; <i class="validated1"></i> </span><span class="span_font"><font class="tishi">提示：</font><font>建议启动全部安全设置，保障账户及资金安全</font></span>{/if} 
          {if $info.is_validated eq 0 && $info.validated eq 0 && $info.is_surplus_open eq 1}比较危险&nbsp; <i class="validated2"></i> </span><span class="span_font"><font class="tishi">提示：</font><font>建议启动全部安全设置，保障账户及资金安全</font></span>{/if} 
          {if $info.is_validated eq 0 && $info.validated eq 1 && $info.is_surplus_open eq 0}比较危险&nbsp; <i class="validated2"></i> </span><span class="span_font"><font class="tishi">提示：</font><font>建议启动全部安全设置，保障账户及资金安全</font></span>{/if} 
          {if $info.is_validated eq 1 && $info.validated eq 0 && $info.is_surplus_open eq 0}比较危险&nbsp; <i class="validated2"></i> </span><span class="span_font"><font class="tishi">提示：</font><font>建议启动全部安全设置，保障账户及资金安全</font></span>{/if} 
          {if $info.is_validated eq 0 && $info.validated eq 1 && $info.is_surplus_open eq 1}一般&nbsp; <i class="validated3"></i> {/if} 
          {if $info.is_validated eq 1 && $info.validated eq 1 && $info.is_surplus_open eq 0}一般&nbsp; <i class="validated3"></i> {/if} 
          {if $info.is_validated eq 1 && $info.validated eq 0 && $info.is_surplus_open eq 1}一般&nbsp; <i class="validated3"></i> {/if} 
          {if $info.is_validated eq 1 && $info.validated eq 1 && $info.is_surplus_open eq 1}高&nbsp; <i class="validated5"></i> {/if} 
          </p> 
          </h5>
          <ul class="s_l ">
            <a href="security.php?act=password_reset">
            <li class="border-bt"><s class="fore1_3"></s>登录密码<span></span> </li>
            </a> 
            <a href="{if $info.email eq ''} security.php?act=email_binding {elseif $info.is_validated eq 0} security.php?act=email_validate {else} security.php?act=email_binding {/if}">
            <li class="border-bt"><s class="{if $info.is_validated eq 0}fore1_1{else}fore1_3{/if}"></s>邮箱验证 <span></span> </li>
            </a> 
            <a href="{if $info.mobile_phone eq ''} security.php?act=mobile_binding {elseif $info.validated eq 0} security.php?act=mobile_validate {else} security.php?act=mobile_binding {/if}">
            <li class="border-bt"><s class="{if $info.validated eq 0}fore1_1{else}fore1_3{/if}"></s>手机验证 <span></span> </li>
            </a> 
            <a href="{if $info.is_surplus_open eq 0}security.php?act=payment_password_reset {else} security.php?act=payment_password_close {/if}">
            <li class="border-bt"><s class="{if $info.is_surplus_open eq 0}fore1_1{else}fore1_3{/if}"></s>支付密码<span></span> </li>
            </a>
          </ul>
          <div class="msg-tip">
          	<p class="tip1">
            	<span>小提示：</span>
            </p>
            <p class="tip2">
              <span class="tishi">登录密码：</span><span class="ftx-03">互联网账号存在被盗风险，建议您定期更改密码以保护账户安全。</span>
            </p>
            <p class="tip2">
              <span class="tishi">邮箱验证：</span><!-- {if $info.is_validated eq 0} --> 
              <span class="ftx-03">验证后，可用于快速找回登录密码，接收账户余额变动提醒</span> 
              <!-- {else} --> 
              <span class="ftx-03">您验证的邮箱：{$info.email}</span>
              <!-- {/if} --> 
            </p>
            <p class="tip2">
              <span class="tishi">手机验证：</span><!-- {if $info.validated eq 0} --> 
              <span class="ftx-03">验证后，可用于快速找回登录密码及支付密码，接收账户余额变动提醒</span> 
              <!-- {else} --> 
              <span class="ftx-03">您验证的手机：{$info.mobile_phone},若已丢失或停用，请立即更换，避免账户被盗</span>
              <!-- {/if} --> 
            </p>
            <p class="tip2">
              <span class="tishi">余额支付：</span><!-- {if $info.is_surplus_open eq 0} --> 
              <span class="ftx-03">开启后，可保障您账户余额支付的安全</span> 
              <!-- {else} --> 
              <span class="ftx-03">您已开启账户余额支付密码功能</span>
              <!-- {/if} -->
            </p>
            <p class="tip2">
              <span class="tishi">&nbsp;</span> 
              <span class="ftx-03">
              	<a href="security.php?act=payment_password_reset">忘记支付密码？</a>
                <a href="security.php?act=payment_password_reset">修改支付密码</a>
              </span>
            </p>
            <div style=" clear:both; "></div>
          </div>
        </div>
        <!-- {/if} --> 
        <!-- 账户中心首页 end --> 
        <!-- 代码增加2015-08-05 by www.68ecshop.com  _star --> 
        <!-- {if $action eq 'password_reset'} -->
        <div class="s_b border-bt">
          <h5 class="user-title user-title-t"> 
          	<p> <span class="span_rank">修改登录密码</span></p>
          </h5>
        <!-- {if $step eq 'step_1'} -->
        <div class="blank" ></div>
        <div id="find_pw" class="find_pw2">
          <div class="find_con">
            <div id="sflex04" class="stepflex">
              <dl class="first doing">
                <dt class="s-num">1</dt>
                <dd class="s-text"> 验证身份 <s></s> <b></b> </dd>
              </dl>
              <dl class="normal">
                <dt class="s-num">2</dt>
                <dd class="s-text"> 设置新密码 <s></s> <b></b> </dd>
              </dl>
              <dl class="last">
                <dt class="s-num">&nbsp;</dt>
                <dd class="s-text"> 完成 <s></s> <b></b> </dd>
              </dl>
            </div>
            <div id="find-box" class="uc_box">
              <form action="security.php" method="post" id="fpForm" name="fpForm">
                <div id="error_container"></div>
                <div class="item">
                  <label class="con_un">验证方式：</label>
                  <select id="validate_type" name="validate_type">
                    <!-- {foreach from=$validate_types item=item} -->
                    <option id="validate_type_{$item.type}" value="{$item.type}" val="{$item.value}">{$item.name}</option>
                    <!-- {/foreach} -->
                  </select>
                </div>
                <div class="item v_mobile_phone v_item" style="display: none">
                  <label class="con_un">手机号：</label>
                  <span id="l_mobile_phone"></span> </div>
                <div id="c_mobile_code" class="item v_mobile_phone v_item" style="display: none">
                  <label class="con_un">手机验证码：</label>
                  <input type="text" id="mobile_code" name="mobile_code" class="text text_te2" value="" />
                  <input id="zphone" type="button" value="获取手机验证码" class="code" />
                </div>
                <div class="item v_email v_item" style="display: none">
                  <label class="con_un">邮箱地址：</label>
                  <span id="l_email"></span> </div>
                <div id="c_email" class="item v_email v_item" style="display: none">
                  <label class="con_un">邮箱验证码：</label>
                  <input type="text" id="email_code" name="email_code" class="text text_te2" value="" />
                  <input id="zemail" type="button" value="获取邮箱验证码" class="code" />
                </div>
                <div class="item v_password v_item" style="display: none">
                  <label class="con_un">用户名：</label>
                  <span id="l_password"></span> </div>
                <div id="c_password" class="item v_password v_item" style="display: none">
                  <label class="con_un">登录密码：</label>
                  <input type="password" id="password" name="password" class="text text_te2" value="" />
                </div>
                <div class="item">
                  <label class="con_un">验证码：</label>
                  <input type="text" id="captcha" name="captcha" class="text text_te" placeholder="{$lang.comment_captcha}" style="ime-mode: disabled" autocomplete="off" MaxLength="6" />
                  <label class="img" style="margin-left: 5px"> <img src="captcha.php?{$rand}" alt="captcha" style="vertical-align: middle; cursor: pointer;" onClick="this.src='captcha.php?'+Math.random();$('#captcha').focus();" /> </label>
                </div>
                <div class="item" style="text-align:center">
                  <input type="hidden" name="act" value="to_password_reset" />
                  <input type="button" name="button" id="btn_submit" class="btn_next" value="提 交" />
                </div>
              </form>
            </div>
          </div>
          <script type="text/javascript">
								function show_validate_type(validate_type_obj){
									var type = $(validate_type_obj).val();
									var value = $("#validate_type_"+type).attr("val");
									$("#l_"+type).html(value);
									$(".v_item").hide();
									$(".v_"+type).show();
								}
								
								function send_email_code(emailCodeObj, sendButton){
									// 发送邮件
									var url = 'validate.php';
									$.post(url, {
										act: 'send_email_code'
									}, function(result) {
										if (result == 'ok') {
											//倒计时
											countdown(sendButton);
										} else {
											alert(result);
										}
									}, 'text');
								}
								
								function send_mobile_code(mobileCodeObj, sendButton) {
									// 发送邮件
									var url = 'validate.php';
									$.post(url, {
										act: 'send_mobile_code'
									}, function(result) {
										if (result == 'ok') {
											//倒计时
											countdown(sendButton);
										} else {
											alert(result);
										}
									}, 'text');
								}
								
								$().ready(function(){
									
									show_validate_type($("#validate_type"));
									
									var validator = $("#fpForm").validate({
										debug: false,
										rules: {
											mobile_code: {
												required: true
											},
											email_code: {
												required: true
											},
											captcha: {
												required: true
											}
										},
										messages: {
											mobile_code: {
												required: "请输入手机验证码"
											},
											email_code: {
												required: "请输入邮箱验证码"
											},
											captcha: {
												required: "请输入验证码"
											}
										},
										errorPlacement: function(error, element) {
											error.appendTo(element.parent());  
										}
									});
									
									$("#validate_type").change(function(){
										show_validate_type($(this));
									});
									
									$("#zphone").click(function(){
										send_mobile_code($("#mobile_code"), $(this));
									});
									
									$("#zemail").click(function(){
										send_email_code($("#email_code"), $(this));
									});
									
									$("#btn_submit").click(function(){
										
										if(!validator.form()){
											return;
										}
										
										var type = $("#validate_type").val();
										
										var url = "security.php";
										var validate_type = $("#validate_type").val();
										$.post(url, {act: "validate", mobile_code: $("#mobile_code").val(), email_code: $("#email_code").val(), password: $("#password").val(), validate_type: validate_type, captcha: $("#captcha").val()}, function(data){
											if(data.error == 1){
												alert(data.content);
												if(data.url != undefined && data.url.length > 0){
													window.location.href = data.url;
												}
											}else{
												$("#fpForm").submit();
											}
										}, "json");
									});
									
								});
							</script> 
        </div>
        <!-- {/if} --> 
        <!-- {if $step eq 'step_2'} -->
        <div class="blank"></div>
        <div id="find_pw3">
          <div class="find_con">
            <div id="sflex04" class="stepflex">
              <dl class="first done">
                <dt class="s-num">1</dt>
                <dd class="s-text"> 验证身份 <s></s> <b></b> </dd>
              </dl>
              <dl class="normal doing">
                <dt class="s-num">2</dt>
                <dd class="s-text"> 设置新密码 <s></s> <b></b> </dd>
              </dl>
              <dl class="last">
                <dt class="s-num">&nbsp;</dt>
                <dd class="s-text"> 完成 <s></s> <b></b> </dd>
              </dl>
            </div>
            <div id="find-box" class="uc_box">
              <form action="security.php" method="post" id="fpForm" name="fpForm">
                <div id="error_container"></div>
                <div class="item">
                  <label class="con_un">设置密码</label>
                  <input name="password" id="password" type="password" tabindex="1" placeholder="请输入密码" class="text" />
                </div>
                <div class="item">
                  <label class="con_un">确认密码</label>
                  <input name="confirm_password" id="confirm_password" type="password" tabindex="2" placeholder="请再次确认密码" class="text" />
                </div>
                <div class="item" style="text-align:center">
                  <input type="hidden" name="act" value="password_reset_success" />
                  <input type="button" id="btn_submit" name="btn_submit" class="btn_next" value="提 交" />
                </div>
              </form>
            </div>
          </div>
          <script type="text/javascript">
								$().ready(function(){
								var validator = $("#fpForm").validate({
									debug: false,
									rules: {
										password: {
											required: true,
											minlength: 6
										},
										confirm_password: {
											required: true,
											equalTo: "#password"
										}
									},
									messages: {
										password: {
											required: "请输入密码",
											minlength: "登录密码不能少于 6 个字符"
										},
										confirm_password: {
											required: "请再次输入新密码",
											equalTo: "两次输入的密码不一致，请重新输入"
										}
									},
									errorPlacement: function(error, element) {
										error.appendTo(element.parent());  
									}
								});
								
								$("#btn_submit").click(function(){
									if(!validator.form()){
										return;
									}
									
									var url = "security.php";
									$.post(url, {act: 'do_password_reset', password: $("#password").val()}, function(data){
										if(data.error == 1){
											alert(data.content);
											if(data.url != undefined && data.url.length > 0){
												window.location.href = data.url;
											}
										}else{
											$("#fpForm").submit();
										}
									}, "json");
										
								});
							});
							</script> 
        </div>
        <!--{/if}--> 
        <!--{if $step eq 'step_3'}--> 
        <!--  斯蒂芬斯蒂芬 -->
        <div class="blank"></div>
        <div id="find_pw3">
          <div class="find_con">
            <div id="sflex04" class="stepflex">
              <dl class="first done">
                <dt class="s-num">1</dt>
                <dd class="s-text"> 验证身份 <s></s> <b></b> </dd>
              </dl>
              <dl class="normal done">
                <dt class="s-num">2</dt>
                <dd class="s-text"> 设置新密码 <s></s> <b></b> </dd>
              </dl>
              <dl class="last doing">
                <dt class="s-num">&nbsp;</dt>
                <dd class="s-text"> 完成 <s></s> <b></b> </dd>
              </dl>
            </div>
            <div id="find-box" class="uc_box">
              <div class="find_box_end">
                <p> <i></i> 新密码设置成功！ </p>
                <p>请您牢记新密码！</p>
                <p class="on_go"> <a href="security.php" title="立即购物" class="back">返回账户安全中心&gt;&gt;</a> </p>
              </div>
            </div>
          </div>
        </div>
        <!--{/if}--> 
        </div>
        <!-- {/if} --> 
        
        <!-- {if $action eq 'email_binding'} -->
        <div class="s_b border-bt">
          <h5 class="user-title user-title-t"> 
          	<p> <span class="span_rank">邮箱绑定</span></p>
          </h5>
        <!-- 邮箱绑定 start--> 
        <!-- {if $step eq 'step_1'} -->
        <div class="blank" ></div>
        <div id="find_pw" class="find_pw2">
          <div class="find_con">
            <div id="sflex04" class="stepflex">
              <dl class="first doing">
                <dt class="s-num">1</dt>
                <dd class="s-text"> 验证身份 <s></s> <b></b> </dd>
              </dl>
              <dl class="normal">
                <dt class="s-num">2</dt>
                <dd class="s-text"> 邮箱绑定 <s></s> <b></b> </dd>
              </dl>
              <dl class="last">
                <dt class="s-num">&nbsp;</dt>
                <dd class="s-text"> 完成 <s></s> <b></b> </dd>
              </dl>
            </div>
            <div id="find-box" class="uc_box">
              <form action="security.php" method="post" id="fpForm" name="fpForm">
                <div id="error_container"></div>
                <div class="item">
                  <label class="con_un">验证身份方式：</label>
                  <select id="validate_type" name="validate_type">
                    <!-- {foreach from=$validate_types item=item} -->
                    <option id="validate_type_{$item.type}" value="{$item.type}" val="{$item.value}">{$item.name}</option>
                    <!-- {/foreach} -->
                  </select>
                </div>
                <div class="item v_mobile_phone v_item" style="display: none">
                  <label class="con_un">手机号：</label>
                  <span id="l_mobile_phone"></span> </div>
                <div id="c_mobile_code" class="item v_mobile_phone v_item" style="display: none">
                  <label class="con_un">手机验证码：</label>
                  <input type="text" id="mobile_code" name="mobile_code" class="text text_te2" value="" />
                  <input id="zphone" type="button" value="获取手机验证码" class="code" />
                </div>
                <div class="item v_email v_item" style="display: none">
                  <label class="con_un">邮箱地址：</label>
                  <span id="l_email"></span> </div>
                <div id="c_email" class="item v_email v_item" style="display: none">
                  <label class="con_un">邮箱验证码：</label>
                  <input type="text" id="email_code" name="email_code" class="text text_te2" value="" />
                  <input id="zemail" type="button" value="获取邮箱验证码" class="code" />
                </div>
                <div class="item v_password v_item" style="display: none">
                  <label class="con_un">用户名：</label>
                  <span id="l_password"></span> </div>
                <div id="c_password" class="item v_password v_item" style="display: none">
                  <label class="con_un">登录密码：</label>
                  <input type="password" id="password" name="password" class="text text_te2" value="" />
                </div>
                <div class="item">
                  <label class="con_un">验证码：</label>
                  <input type="text" id="captcha" size="8" name="captcha" class="text text_te" placeholder="{$lang.comment_captcha}" style="ime-mode: disabled" autocomplete="off" MaxLength="6" />
                  <label class="img" style="margin-left: 5px"> <img src="captcha.php?{$rand}" alt="captcha" style="vertical-align: middle; cursor: pointer;" onClick="this.src='captcha.php?'+Math.random();$('#captcha').focus();" /> </label>
                </div>
                <div class="item" style="text-align:center">
                  <input type="hidden" name="act" value="to_email_binding" />
                  <input type="button" name="button" id="btn_submit" class="btn_next" value="提 交" />
                </div>
              </form>
            </div>
          </div>
          <script type="text/javascript">
								function show_validate_type(validate_type_obj){
									var type = $(validate_type_obj).val();
									var value = $("#validate_type_"+type).attr("val");
									$("#l_"+type).html(value);
									$(".v_item").hide();
									$(".v_"+type).show();
								}
								
								function send_email_code(emailCodeObj, sendButton){
									// 发送邮件
									var url = 'validate.php';
									$.post(url, {
										act: 'send_email_code'
									}, function(result) {
										if (result == 'ok') {
											//倒计时
											countdown(sendButton);
										} else {
											alert(result);
										}
									}, 'text');
								}
								
								function send_mobile_code(mobileCodeObj, sendButton) {
									// 发送邮件
									var url = 'validate.php';
									$.post(url, {
										act: 'send_mobile_code'
									}, function(result) {
										if (result == 'ok') {
											//倒计时
											countdown(sendButton);
										} else {
											alert(result);
										}
									}, 'text');
								}
								
								$().ready(function(){
									
									show_validate_type($("#validate_type"));
									
									var validator = $("#fpForm").validate({
										debug: false,
										rules: {
											mobile_code: {
												required: true
											},
											email_code: {
												required: true
											},
											captcha: {
												required: true
											}
										},
										messages: {
											mobile_code: {
												required: "请输入手机验证码"
											},
											email_code: {
												required: "请输入邮箱验证码"
											},
											captcha: {
												required: "请输入验证码"
											}
										},
										errorPlacement: function(error, element) {
											error.appendTo(element.parent());  
										}
									});
									
									$("#validate_type").change(function(){
										show_validate_type($(this));
									});
									
									$("#zphone").click(function(){
										send_mobile_code($("#mobile_code"), $(this));
									});
									
									$("#zemail").click(function(){
										send_email_code($("#email_code"), $(this));
									});
									
									$("#btn_submit").click(function(){
										
										if(!validator.form()){
											return;
										}
										
										var type = $("#validate_type").val();
										
										var url = "security.php";
										var validate_type = $("#validate_type").val();
										$.post(url, {act: "validate", mobile_code: $("#mobile_code").val(), email_code: $("#email_code").val(), password: $("#password").val(), validate_type: validate_type, captcha: $("#captcha").val()}, function(data){
											if(data.error == 1){
												alert(data.content);
												if(data.url != undefined && data.url.length > 0){
													window.location.href = data.url;
												}
											}else{
												$("#fpForm").submit();
											}
										}, "json");
									});
									
								});
							</script> 
        </div>
        <!-- {/if} --> 
        <!-- {if $step eq 'step_2'} -->
        <div class="blank"></div>
        <div id="find_pw3">
          <div class="find_con">
            <div id="sflex04" class="stepflex">
              <dl class="first done">
                <dt class="s-num">1</dt>
                <dd class="s-text"> 验证身份 <s></s> <b></b> </dd>
              </dl>
              <dl class="normal doing">
                <dt class="s-num">2</dt>
                <dd class="s-text"> 邮箱绑定 <s></s> <b></b> </dd>
              </dl>
              <dl class="last">
                <dt class="s-num">&nbsp;</dt>
                <dd class="s-text"> 完成 <s></s> <b></b> </dd>
              </dl>
            </div>
            <div id="find-box" class="uc_box">
              <form action="security.php" method="post" id="fpForm" name="fpForm">
                <div id="error_container"></div>
                <div class="item">
                  <label class="con_un">邮箱地址：</label>
                  <input name="email" id="email" type="text" tabindex="1" placeholder="请输入邮箱地址" class="text" />
                </div>
                <div class="item">
                  <label class="con_un">邮箱验证码：</label>
                  <input name="email_code" id="email_code" type="text" tabindex="2" placeholder="邮箱验证码" class="text text_te" />
                  <input id="zemail" type="button" value="获取邮箱验证码" class="code" />
                </div>
                <div class="item" style="text-align:center">
                  <label class="con_un">&nbsp;</label>
                  <input type="hidden" name="act" value="email_binding_success" />
                  <input type="button" id="btn_submit" name="btn_submit" class="btn_next" value="提 交" />
                </div>
              </form>
            </div>
          </div>
          <script type="text/javascript">
								function send_email_code(emailCodeObj, sendButton){
									// 发送邮件
									var url = 'security.php?XDEBUG_SESSION_START=ECLIPSE_DBGP';
									$.post(url, {
										act: 'send_email_code', 
										email: $("#email").val()
									}, function(result) {
										if (result == 'ok') {
											//倒计时
											countdown(sendButton);
										} else {
											alert(result);
										}
									}, 'text');
								}
								
								$().ready(function(){
									
									var validator = $("#fpForm").validate({
										debug: false,
										rules: {
											email: {
												required: true,
												email: true,
												remote: {  
												    url: "security.php",     //后台处理程序  
												    type: "post",               //数据发送方式  
												    dataType: "json",           //接受数据格式     
												    data: {                     //要传递的数据  
												    	act: 'check_email_exist',
												        email: function() {  
												            return $("#email").val();  
												        }  
												    }  
												}
											},
											email_code: {
												required: true
											}
										},
										messages: {
											email: {
												required: "请输入手机验证码",
												email: "邮箱格式不正确",
												remote: "邮箱已存在"
											},
											email_code: {
												required: "请输入邮箱验证码"
											}
										},
										errorPlacement: function(error, element) {
											error.appendTo(element.parent());  
										}
									});
									
									$("#email").blur(function(){
										$(this).valid();
									});
									
									$("#zemail").click(function(){
										if(!$("#email").valid()){
											return;
										}
										send_email_code($("#email_code"), $(this));
									});
									
									$("#btn_submit").click(function(){
										
										if(!validator.form()){
											return;
										}
										
										var type = $("#validate_type").val();
										
										var url = "security.php";
										$.post(url, {act: "do_email_binding", email_code: $("#email_code").val()}, function(data){
											if(data.error == 1){
												alert(data.content);
												if(data.url != undefined && data.url.length > 0){
													window.location.href = data.url;
												}
											}else{
												$("#fpForm").submit();
											}
										}, "json");
									});
									
								});
							</script> 
        </div>
        <!-- {/if} --> 
        <!-- {if $step eq 'step_3'} -->
        <div class="blank"></div>
        <div id="find_pw3">
          <div class="find_con">
            <div id="sflex04" class="stepflex">
              <dl class="first done">
                <dt class="s-num">1</dt>
                <dd class="s-text"> 验证身份 <s></s> <b></b> </dd>
              </dl>
              <dl class="normal done">
                <dt class="s-num">2</dt>
                <dd class="s-text"> 绑定邮箱 <s></s> <b></b> </dd>
              </dl>
              <dl class="last doing">
                <dt class="s-num">&nbsp;</dt>
                <dd class="s-text"> 完成 <s></s> <b></b> </dd>
              </dl>
            </div>
            <div id="find-box" class="uc_box">
              <div class="find_box_end">
                <p> <i></i> 绑定邮箱成功！ </p>
                <p class="on_go"> <a href="security.php" title="立即购物" class="back">返回账户安全中心&gt;&gt;</a> </p>
              </div>
            </div>
          </div>
        </div>
        <!-- {/if} --> 
        <!-- 邮箱绑定  end--> 
        </div>
        <!-- {/if} --> 
        
        <!-- {if $action eq 'email_validate'} -->
        <div class="s_b border-bt">
          <h5 class="user-title user-title-t"> 
          	<p> <span class="span_rank">邮箱验证</span></p>
          </h5>
        <!-- 邮箱验证 start--> 
        <!-- {if $step eq 'step_1'} -->
        <div class="blank"></div>
        <div id="find_pw3">
          <div class="find_con">
            <div id="sflex04" class="stepflex stepflex_te">
              <dl class="first doing">
                <dt class="s-num">1</dt>
                <dd class="s-text"> 邮箱验证 <s></s> <b></b> </dd>
              </dl>
              <dl class="last">
                <dt class="s-num">&nbsp;</dt>
                <dd class="s-text"> 完成 <s></s> <b></b> </dd>
              </dl>
            </div>
            <div id="find-box" class="uc_box">
              <form action="security.php" method="post" id="fpForm" name="fpForm">
                <div id="error_container"></div>
                <div class="item">
                  <label class="con_un">邮箱地址：</label>
                  <span id="l_email">{$email}</span> </div>
                <div class="item">
                  <label class="con_un">邮箱验证码：</label>
                  <input name="email_code" id="email_code" type="text" tabindex="2" placeholder="邮箱验证码" class="text text_te" />
                  <input id="zemail" type="button" value="获取邮箱验证码" class="code" />
                </div>
                <div class="item">
                  <label class="con_un">验证码：</label>
                  <input type="text" id="captcha" size="8" name="captcha" class="text text_te" placeholder="{$lang.comment_captcha}" style="ime-mode: disabled" autocomplete="off" MaxLength="6" />
                  <label class="img" style="margin-left: 5px"> <img src="captcha.php?{$rand}" alt="captcha" style="vertical-align: middle; cursor: pointer;" onClick="this.src='captcha.php?'+Math.random();$('#captcha').focus();" /> </label>
                </div>
                <div class="item" style="text-align:center">
                  <input type="hidden" name="act" value="email_validate_success" />
                  <input type="button" id="btn_submit" name="btn_submit" class="btn_next" value="提 交" />
                </div>
              </form>
            </div>
          </div>
          <script type="text/javascript">
								function send_email_code(emailCodeObj, sendButton){
									// 发送邮件
									var url = 'validate.php';
									$.post(url, {
										act: 'send_email_code'
									}, function(result) {
										if (result == 'ok') {
											//倒计时
											countdown(sendButton);
										} else {
											alert(result);
										}
									}, 'text');
								}
								
								$().ready(function(){
									
									var validator = $("#fpForm").validate({
										debug: false,
										rules: {
											captcha: {
												required: true
											},
											email_code: {
												required: true
											}
										},
										messages: {
											captcha: {
												required: "请输入验证码"
											},
											email_code: {
												required: "请输入邮箱验证码"
											}
										},
										errorPlacement: function(error, element) {
											error.appendTo(element.parent());  
										}
									});
									
									$("#zemail").click(function(){
										send_email_code($("#email_code"), $(this));
									});
									
									$("#btn_submit").click(function(){
										
										if(!validator.form()){
											return;
										}
										
										var type = $("#validate_type").val();
										
										var url = "security.php";
										$.post(url, {act: "do_email_validate", email_code: $("#email_code").val(), captcha: $("#captcha").val()}, function(data){
											if(data.error == 1){
												alert(data.content);
												if(data.url != undefined && data.url.length > 0){
													window.location.href = data.url;
												}
											}else{
												$("#fpForm").submit();
											}
										}, "json");
									});
									
								});
							</script> 
        </div>
        <!-- {/if} --> 
        <!-- {if $step eq 'step_2'} -->
        <div class="blank"></div>
        <div id="find_pw3">
          <div class="find_con">
            <div id="sflex04" class="stepflex stepflex_te">
              <dl class="normal done">
                <dt class="s-num">1</dt>
                <dd class="s-text"> 邮箱验证 <s></s> <b></b> </dd>
              </dl>
              <dl class="last doing">
                <dt class="s-num">&nbsp;</dt>
                <dd class="s-text"> 完成 <s></s> <b></b> </dd>
              </dl>
            </div>
            <div id="find-box" class="uc_box">
              <div class="find_box_end">
                <p> <i></i> 邮箱验证成功！ </p>
                <p class="on_go"> <a href="security.php" title="立即购物" class="back">返回账户安全中心&gt;&gt;</a> </p>
              </div>
            </div>
          </div>
        </div>
        <!-- {/if} --> 
        <!-- 邮箱 验证  end--> 
        </div>
        <!-- {/if} --> 
        
        <!-- {if $action eq 'mobile_binding'} --> 
        <div class="s_b border-bt">
          <h5 class="user-title user-title-t"> 
          	<p> <span class="span_rank">手机绑定</span></p>
          </h5>
        <!-- 绑定手机 start-->
        <!-- {if $step eq 'step_1'} -->
        <div class="blank" ></div>
        <div id="find_pw" class="find_pw2">
          <div class="find_con">
            <div id="sflex04" class="stepflex">
              <dl class="first doing">
                <dt class="s-num">1</dt>
                <dd class="s-text"> 验证身份 <s></s> <b></b> </dd>
              </dl>
              <dl class="normal">
                <dt class="s-num">2</dt>
                <dd class="s-text"> 手机绑定 <s></s> <b></b> </dd>
              </dl>
              <dl class="last">
                <dt class="s-num">&nbsp;</dt>
                <dd class="s-text"> 完成 <s></s> <b></b> </dd>
              </dl>
            </div>
            <div id="find-box" class="uc_box">
              <form action="security.php" method="post" id="fpForm" name="fpForm">
                <div id="error_container"></div>
                <div class="item">
                  <label class="con_un">验证身份方式：</label>
                  <select id="validate_type" name="validate_type">
                    <!-- {foreach from=$validate_types item=item} -->
                    <option id="validate_type_{$item.type}" value="{$item.type}" val="{$item.value}">{$item.name}</option>
                    <!-- {/foreach} -->
                  </select>
                </div>
                <div class="item v_mobile_phone v_item" style="display: none">
                  <label class="con_un">手机号：</label>
                  <span id="l_mobile_phone"></span> </div>
                <div id="c_mobile_code" class="item v_mobile_phone v_item" style="display: none">
                  <label class="con_un">手机验证码：</label>
                  <input type="text" id="mobile_code" name="mobile_code" class="text text_te2" value="" />
                  <input id="zphone" type="button" value="获取手机验证码" class="code" />
                </div>
                <div class="item v_email v_item" style="display: none">
                  <label class="con_un">邮箱地址：</label>
                  <span id="l_email"></span> </div>
                <div id="c_email" class="item v_email v_item" style="display: none">
                  <label class="con_un">邮箱验证码：</label>
                  <input type="text" id="email_code" name="email_code" class="text text_te2" value="" />
                  <input id="zemail" type="button" value="获取邮箱验证码" class="code" />
                </div>
                <div class="item v_password v_item" style="display: none">
                  <label class="con_un">用户名：</label>
                  <span id="l_password"></span> </div>
                <div id="c_password" class="item v_password v_item" style="display: none">
                  <label class="con_un">登录密码：</label>
                  <input type="password" id="password" name="password" class="text text_te2" value="" />
                </div>
                <div class="item">
                  <label class="con_un">验证码：</label>
                  <input type="text" id="captcha" size="8" name="captcha" class="text text_te" placeholder="{$lang.comment_captcha}" style="ime-mode: disabled" autocomplete="off" MaxLength="6" />
                  <label class="img" style="margin-left: 5px"> <img src="captcha.php?{$rand}" alt="captcha" style="vertical-align: middle; cursor: pointer;" onClick="this.src='captcha.php?'+Math.random();$('#captcha').focus();" /> </label>
                </div>
                <div class="item" style="text-align:center">
                  <input type="hidden" name="act" value="to_mobile_binding" />
                  <input type="button" name="button" id="btn_submit" class="btn_next" value="提 交" />
                </div>
              </form>
            </div>
          </div>
          <script type="text/javascript">
								function show_validate_type(validate_type_obj){
									var type = $(validate_type_obj).val();
									var value = $("#validate_type_"+type).attr("val");
									$("#l_"+type).html(value);
									$(".v_item").hide();
									$(".v_"+type).show();
								}
								
								function send_email_code(emailCodeObj, sendButton){
									// 发送邮件
									var url = 'validate.php';
									$.post(url, {
										act: 'send_email_code'
									}, function(result) {
										if (result == 'ok') {
											//倒计时
											countdown(sendButton);
										} else {
											alert(result);
										}
									}, 'text');
								}
								
								function send_mobile_code(mobileCodeObj, sendButton) {
									// 发送邮件
									var url = 'validate.php';
									$.post(url, {
										act: 'send_mobile_code'
									}, function(result) {
										if (result == 'ok') {
											//倒计时
											countdown(sendButton);
										} else {
											alert(result);
										}
									}, 'text');
								}
								
								$().ready(function(){
									
									show_validate_type($("#validate_type"));
									
									var validator = $("#fpForm").validate({
										debug: false,
										rules: {
											mobile_code: {
												required: true
											},
											email_code: {
												required: true
											},
											captcha: {
												required: true
											}
										},
										messages: {
											mobile_code: {
												required: "请输入手机验证码"
											},
											email_code: {
												required: "请输入邮箱验证码"
											},
											captcha: {
												required: "请输入验证码"
											}
										},
										errorPlacement: function(error, element) {
											error.appendTo(element.parent());  
										}
									});
									
									$("#validate_type").change(function(){
										show_validate_type($(this));
									});
									
									$("#zphone").click(function(){
										send_mobile_code($("#mobile_code"), $(this));
									});
									
									$("#zemail").click(function(){
										send_email_code($("#email_code"), $(this));
									});
									
									$("#btn_submit").click(function(){
										
										if(!validator.form()){
											return;
										}
										
										var type = $("#validate_type").val();
										
										var url = "security.php";
										var validate_type = $("#validate_type").val();
										$.post(url, {act: "validate", mobile_code: $("#mobile_code").val(), email_code: $("#email_code").val(), password: $("#password").val(), validate_type: validate_type, captcha: $("#captcha").val()}, function(data){
											if(data.error == 1){
												alert(data.content);
												if(data.url != undefined && data.url.length > 0){
													window.location.href = data.url;
												}
											}else{
												$("#fpForm").submit();
											}
										}, "json");
									});
									
								});
							</script> 
        </div>
        <!-- {/if} --> 
        <!-- {if $step eq 'step_2'} -->
        <div class="blank"></div>
        <div id="find_pw3">
          <div class="find_con">
            <div id="sflex04" class="stepflex">
              <dl class="first done">
                <dt class="s-num">1</dt>
                <dd class="s-text"> 验证身份 <s></s> <b></b> </dd>
              </dl>
              <dl class="normal doing">
                <dt class="s-num">2</dt>
                <dd class="s-text"> 手机绑定 <s></s> <b></b> </dd>
              </dl>
              <dl class="last">
                <dt class="s-num">&nbsp;</dt>
                <dd class="s-text"> 完成 <s></s> <b></b> </dd>
              </dl>
            </div>
            <div id="find-box" class="uc_box">
              <form action="security.php" method="post" id="fpForm" name="fpForm">
                <div id="error_container"></div>
                <div class="item">
                  <label class="con_un">手机号码：</label>
                  <input name="mobile" id="mobile" type="text" tabindex="1" placeholder="手机号码" class="text" />
                </div>
                <div class="item">
                  <label class="con_un">手机验证码：</label>
                  <input name="mobile_code" id="mobile_code" type="text" tabindex="2" placeholder="手机验证码" class="text text_te" />
                  <input id="zphone" type="button" value="获取短信验证码" class="code" />
                </div>
                <div class="item" style="text-align:center">
                  <input type="hidden" name="act" value="mobile_binding_success" />
                  <input type="button" id="btn_submit" name="btn_submit" class="btn_next" value="提 交" />
                </div>
              </form>
            </div>
          </div>
          <script type="text/javascript">
								function send_mobile_code(mobileCodeObj, sendButton){
									// 发送邮件
									var url = 'security.php?XDEBUG_SESSION_START=ECLIPSE_DBGP';
									$.post(url, {
										act: 'send_mobile_code', 
										mobile: $("#mobile").val()
									}, function(result) {
										if (result == 'ok') {
											//倒计时
											countdown(sendButton);
										} else {
											alert(result);
										}
									}, 'text');
								}
								
								$().ready(function(){
									
									$.validator.addMethod("mobile", function(value, element){
										return Utils.isMobile(value);
									});
									
									var validator = $("#fpForm").validate({
										debug: false,
										rules: {
											mobile: {
												required: true,
												mobile: true,
												remote: {  
												    url: "security.php",     //后台处理程序  
												    type: "post",               //数据发送方式  
												    dataType: "json",           //接受数据格式     
												    data: {                     //要传递的数据  
												    	act: 'check_mobile_exist',
												        email: function() {  
												            return $("#email").val();  
												        }  
												    }  
												}
											},
											mobile_code: {
												required: true
											}
										},
										messages: {
											mobile: {
												required: "请输入手机验证码",
												mobile: "手机号码格式不正确",
												remote: "手机号码已存在"
											},
											mobile_code: {
												required: "请输入手机验证码"
											}
										},
										errorPlacement: function(error, element) {
											error.appendTo(element.parent());  
										}
									});
									
									$("#mobile").blur(function(){
										$(this).valid();
									});
									
									$("#zphone").click(function(){
										if(!$("#mobile").valid()){
											return;
										}
										send_mobile_code($("#mobile_code"), $(this));
									});
									
									$("#btn_submit").click(function(){
										
										if(!validator.form()){
											return;
										}
										
										var type = $("#validate_type").val();
										
										var url = "security.php";
										$.post(url, {act: "do_mobile_binding", mobile: $("#mobile").val(), mobile_code: $("#mobile_code").val()}, function(data){
											if(data.error == 1){
												alert(data.content);
												if(data.url != undefined && data.url.length > 0){
													window.location.href = data.url;
												}
											}else{
												$("#fpForm").submit();
											}
										}, "json");
									});
									
								});
							</script> 
        </div>
        <!-- {/if} --> 
        <!-- {if $step eq 'step_3'} -->
        <div class="blank"></div>
        <div id="find_pw3">
          <div class="find_con">
            <div id="sflex04" class="stepflex">
              <dl class="first done">
                <dt class="s-num">1</dt>
                <dd class="s-text"> 验证身份 <s></s> <b></b> </dd>
              </dl>
              <dl class="normal done">
                <dt class="s-num">2</dt>
                <dd class="s-text"> 手机绑定 <s></s> <b></b> </dd>
              </dl>
              <dl class="last doing">
                <dt class="s-num">&nbsp;</dt>
                <dd class="s-text"> 完成 <s></s> <b></b> </dd>
              </dl>
            </div>
            <div id="find-box" class="uc_box">
              <div class="find_box_end">
                <p> <i></i> 手机绑定成功！ </p>
                <p class="on_go"> <a href="security.php" title="立即购物" class="back">返回账户安全中心&gt;&gt;</a> </p>
              </div>
            </div>
          </div>
        </div>
        <!-- {/if} --> 
        <!-- 绑定手机  end--> 
        </div>
        <!-- {/if} --> 
        
        <!-- {if $action eq 'mobile_validate'} -->
        <div class="s_b border-bt">
          <h5 class="user-title user-title-t"> 
          	<p> <span class="span_rank">手机验证</span></p>
          </h5>
        <!-- 手机验证 start--> 
        <!-- {if $step eq 'step_1'} -->
        <div class="blank"></div>
        <div id="find_pw3">
          <div class="find_con">
            <div id="sflex04" class="stepflex stepflex_te">
              <dl class="first doing">
                <dt class="s-num">1</dt>
                <dd class="s-text"> 手机验证 <s></s> <b></b> </dd>
              </dl>
              <dl class="last">
                <dt class="s-num">&nbsp;</dt>
                <dd class="s-text"> 完成 <s></s> <b></b> </dd>
              </dl>
            </div>
            <div id="find-box" class="uc_box">
              <form action="security.php" method="post" id="fpForm" name="fpForm">
                <div id="error_container"></div>
                <div class="item">
                  <label class="con_un">手机号码：</label>
                  <span id="l_mobile">{$mobile}</span> </div>
                <div class="item">
                  <label class="con_un">手机验证码：</label>
                  <input name="mobile_code" id="mobile_code" type="text" tabindex="2" placeholder="手机验证码" class="text text_te" />
                  <input id="zphone" type="button" value="获取短信验证码" class="code" />
                </div>
                <div class="item">
                  <label class="con_un">验证码：</label>
                  <input type="text" id="captcha" size="8" name="captcha" class="text text_te" placeholder="{$lang.comment_captcha}" style="ime-mode: disabled" autocomplete="off" MaxLength="6" />
                  <label class="img" style="margin-left: 5px"> <img src="captcha.php?{$rand}" alt="captcha" style="vertical-align: middle; cursor: pointer;" onClick="this.src='captcha.php?'+Math.random();$('#captcha').focus();" /> </label>
                </div>
                <div class="item" style="text-align:center">
                  <input type="hidden" name="act" value="mobile_validate_success" />
                  <input type="button" id="btn_submit" name="btn_submit" class="btn_next" value="提 交" />
                </div>
              </form>
            </div>
          </div>
          <script type="text/javascript">
								function send_mobile_code(emailCodeObj, sendButton){
									// 发送邮件
									var url = 'validate.php';
									$.post(url, {
										act: 'send_mobile_code'
									}, function(result) {
										if (result == 'ok') {
											//倒计时
											countdown(sendButton);
										} else {
											alert(result);
										}
									}, 'text');
								}
								
								$().ready(function(){
									
									var validator = $("#fpForm").validate({
										debug: false,
										rules: {
											captcha: {
												required: true
											},
											mobile_code: {
												required: true
											}
										},
										messages: {
											captcha: {
												required: "请输入验证码"
											},
											mobile_code: {
												required: "请输入手机验证码"
											}
										},
										errorPlacement: function(error, element) {
											error.appendTo(element.parent());  
										}
									});
									
									$("#zphone").click(function(){
										send_mobile_code($("#mobile_code"), $(this));
									});
									
									$("#btn_submit").click(function(){
										
										if(!validator.form()){
											return;
										}
										
										var type = $("#validate_type").val();
										
										var url = "security.php?XDEBUG_SESSION_START=ECLIPSE_DBGP";
										$.post(url, {act: "do_mobile_validate", mobile_code: $("#mobile_code").val(), captcha: $("#captcha").val()}, function(data){
											if(data.error == 1){
												alert(data.content);
												if(data.url != undefined && data.url.length > 0){
													window.location.href = data.url;
												}
											}else{
												$("#fpForm").submit();
											}
										}, "json");
									});
									
								});
							</script> 
        </div>
        <!-- {/if} --> 
        <!-- {if $step eq 'step_2'} -->
        <div class="blank"></div>
        <div id="find_pw3">
          <div class="find_con">
            <div id="sflex04" class="stepflex">
              <dl class="normal done">
                <dt class="s-num">1</dt>
                <dd class="s-text"> 手机验证 <s></s> <b></b> </dd>
              </dl>
              <dl class="last doing">
                <dt class="s-num">&nbsp;</dt>
                <dd class="s-text"> 完成 <s></s> <b></b> </dd>
              </dl>
            </div>
            <div id="find-box" class="uc_box">
              <div class="find_box_end">
                <p> <i></i> 手机验证成功！ </p>
                <p class="on_go"> <a href="security.php" title="立即购物" class="back">返回账户安全中心&gt;&gt;</a> </p>
              </div>
            </div>
          </div>
        </div>
        <!-- {/if} --> 
        <!-- 手机验证  end--> 
        </div>
        <!-- {/if} --> 
        
        <!-- {if $action eq 'payment_password_reset'} --> 
        <div class="s_b border-bt">
          <h5 class="user-title user-title-t"> 
          	<p> <span class="span_rank">设置支付密码</span></p>
          </h5>
        <!-- 绑定手机 start-->
        <!-- {if $step eq 'step_1'} -->
        <div class="blank" ></div>
        <div id="find_pw" class="find_pw2">
          <div class="find_con">
            <div id="sflex04" class="stepflex">
              <dl class="first doing">
                <dt class="s-num">1</dt>
                <dd class="s-text"> 验证身份 <s></s> <b></b> </dd>
              </dl>
              <dl class="normal">
                <dt class="s-num">2</dt>
                <dd class="s-text"> 设置支付密码 <s></s> <b></b> </dd>
              </dl>
              <dl class="last">
                <dt class="s-num">&nbsp;</dt>
                <dd class="s-text"> 完成 <s></s> <b></b> </dd>
              </dl>
            </div>
            <div id="find-box" class="uc_box">
              <form action="security.php" method="post" id="fpForm" name="fpForm">
                <div id="error_container"></div>
                <div class="item">
                  <label class="con_un">验证身份方式：</label>
                  <select id="validate_type" name="validate_type">
                    <!-- {foreach from=$validate_types item=item} -->
                    <option id="validate_type_{$item.type}" value="{$item.type}" val="{$item.value}">{$item.name}</option>
                    <!-- {/foreach} -->
                  </select>
                </div>
                <div class="item v_mobile_phone v_item" style="display: none">
                  <label class="con_un">手机号：</label>
                  <span id="l_mobile_phone"></span> </div>
                <div id="c_mobile_code" class="item v_mobile_phone v_item" style="display: none">
                  <label class="con_un">手机验证码：</label>
                  <input type="text" id="mobile_code" name="mobile_code" class="text text_te2" value="" />
                  <input id="zphone" type="button" value="获取手机验证码" class="code" />
                </div>
                <div class="item v_email v_item" style="display: none">
                  <label class="con_un">邮箱地址：</label>
                  <span id="l_email"></span> </div>
                <div id="c_email" class="item v_email v_item" style="display: none">
                  <label class="con_un">邮箱验证码：</label>
                  <input type="text" id="email_code" name="email_code" class="text text_te2" value="" />
                  <input id="zemail" type="button" value="获取邮箱验证码" class="code" />
                </div>
                <div class="item v_password v_item" style="display: none">
                  <label class="con_un">用户名：</label>
                  <span id="l_password"></span> </div>
                <div id="c_password" class="item v_password v_item" style="display: none">
                  <label class="con_un">登录密码：</label>
                  <input type="password" id="password" name="password" class="text text_te2" value="" />
                </div>
                <div class="item">
                  <label class="con_un">验证码：</label>
                  <input type="text" id="captcha" size="8" name="captcha" class="text text_te" placeholder="{$lang.comment_captcha}" style="ime-mode: disabled" autocomplete="off" MaxLength="6" />
                  <label class="img" style="margin-left: 5px"> <img src="captcha.php?{$rand}" alt="captcha" style="vertical-align: middle; cursor: pointer;" onClick="this.src='captcha.php?'+Math.random();$('#captcha').focus();" /> </label>
                </div>
                <div class="item" style="text-align:center">
                  <input type="hidden" name="act" value="to_payment_password_reset" />
                  <input type="button" name="button" id="btn_submit" class="btn_next" value="提 交" />
                </div>
              </form>
            </div>
          </div>
          <script type="text/javascript">
								function show_validate_type(validate_type_obj){
									var type = $(validate_type_obj).val();
									var value = $("#validate_type_"+type).attr("val");
									$("#l_"+type).html(value);
									$(".v_item").hide();
									$(".v_"+type).show();
								}
								
								function send_email_code(emailCodeObj, sendButton){
									// 发送邮件
									var url = 'validate.php';
									$.post(url, {
										act: 'send_email_code'
									}, function(result) {
										if (result == 'ok') {
											//倒计时
											countdown(sendButton);
										} else {
											alert(result);
										}
									}, 'text');
								}
								
								function send_mobile_code(mobileCodeObj, sendButton) {
									// 发送邮件
									var url = 'validate.php';
									$.post(url, {
										act: 'send_mobile_code'
									}, function(result) {
										if (result == 'ok') {
											//倒计时
											countdown(sendButton);
										} else {
											alert(result);
										}
									}, 'text');
								}
								
								$().ready(function(){
									
									show_validate_type($("#validate_type"));
									
									var validator = $("#fpForm").validate({
										debug: false,
										rules: {
											mobile_code: {
												required: true
											},
											email_code: {
												required: true
											},
											captcha: {
												required: true
											}
										},
										messages: {
											mobile_code: {
												required: "请输入手机验证码"
											},
											email_code: {
												required: "请输入邮箱验证码"
											},
											captcha: {
												required: "请输入验证码"
											}
										},
										errorPlacement: function(error, element) {
											error.appendTo(element.parent());  
										}
									});
									
									$("#validate_type").change(function(){
										show_validate_type($(this));
									});
									
									$("#zphone").click(function(){
										send_mobile_code($("#mobile_code"), $(this));
									});
									
									$("#zemail").click(function(){
										send_email_code($("#email_code"), $(this));
									});
									
									$("#btn_submit").click(function(){
										
										if(!validator.form()){
											return;
										}
										
										var type = $("#validate_type").val();
										
										var url = "security.php";
										var validate_type = $("#validate_type").val();
										$.post(url, {act: "validate", mobile_code: $("#mobile_code").val(), email_code: $("#email_code").val(), password: $("#password").val(), validate_type: validate_type, captcha: $("#captcha").val()}, function(data){
											if(data.error == 1){
												alert(data.content);
												if(data.url != undefined && data.url.length > 0){
													window.location.href = data.url;
												}
											}else{
												$("#fpForm").submit();
											}
										}, "json");
									});
									
								});
							</script> 
        </div>
        <!-- {/if} --> 
        <!-- {if $step eq 'step_2'} -->
        <div class="blank"></div>
        <div id="find_pw3">
          <div class="find_con">
            <div id="sflex04" class="stepflex">
              <dl class="first done">
                <dt class="s-num">1</dt>
                <dd class="s-text"> 验证身份 <s></s> <b></b> </dd>
              </dl>
              <dl class="normal doing">
                <dt class="s-num">2</dt>
                <dd class="s-text"> 设置支付密码 <s></s> <b></b> </dd>
              </dl>
              <dl class="last">
                <dt class="s-num">&nbsp;</dt>
                <dd class="s-text"> 完成 <s></s> <b></b> </dd>
              </dl>
            </div>
            <div id="find-box" class="uc_box">
              <form action="security.php" method="post" id="fpForm" name="fpForm">
                <div id="error_container"></div>
                <div class="item">
                  <label class="con_un">设置支付密码：</label>
                  <input name="password" id="password" type="password" tabindex="1" placeholder="请输入支付密码" class="text" />
                </div>
                <div class="item">
                  <label class="con_un">重新输入密码：</label>
                  <input name="confirm_password" id="confirm_password" type="password" tabindex="1" placeholder="再次输入确认密码" class="text" />
                </div>
                <div class="item" style="text-align:center">
                  <input type="hidden" name="act" value="payment_password_reset_success" />
                  <input type="button" id="btn_submit" name="btn_submit" class="btn_next" value="提 交" />
                </div>
              </form>
            </div>
          </div>
          <script type="text/javascript">
								$().ready(function(){
									var validator = $("#fpForm").validate({
										debug: false,
										rules: {
											password: {
												required: true,
												minlength: 6
											},
											confirm_password: {
												required: true,
												equalTo: "#password"
											}
										},
										messages: {
											password: {
												required: "请输入密码",
												minlength: "登录密码不能少于 6 个字符"
											},
											confirm_password: {
												required: "请再次输入新密码",
												equalTo: "两次输入的密码不一致，请重新输入"
											}
										},
										errorPlacement: function(error, element) {
											error.appendTo(element.parent());
										}
									});
									
									$("#btn_submit").click(function(){
										if(!validator.form()){
											return;
										}
										
										var url = "security.php";
										$.post(url, {act: 'do_payment_password_reset', password: $("#password").val()}, function(data){
											if(data.error == 1){
												alert(data.content);
												if(data.url != undefined && data.url.length > 0){
													window.location.href = data.url;
												}
											}else{
												$("#fpForm").submit();
											}
										}, "json");
											
									});
								});
								</script> 
        </div>
        <!-- {/if} --> 
        <!-- {if $step eq 'step_3'} -->
        <div class="blank"></div>
        <div id="find_pw3">
          <div class="find_con">
            <div id="sflex04" class="stepflex">
              <dl class="first done">
                <dt class="s-num">1</dt>
                <dd class="s-text"> 验证身份 <s></s> <b></b> </dd>
              </dl>
              <dl class="normal done">
                <dt class="s-num">2</dt>
                <dd class="s-text"> 设置支付密码 <s></s> <b></b> </dd>
              </dl>
              <dl class="last doing">
                <dt class="s-num">&nbsp;</dt>
                <dd class="s-text"> 完成 <s></s> <b></b> </dd>
              </dl>
            </div>
            <div id="find-box" class="uc_box">
              <div class="find_box_end">
                <p> <i></i> 设置支付密码成功！ </p>
                <p class="on_go"> <a href="security.php" title="立即购物" class="back">返回账户安全中心&gt;&gt;</a> </p>
              </div>
            </div>
          </div>
        </div>
        <!-- {/if} --> 
        <!-- 开启、修改、忘记支付密码  end--> 
        </div>
        <!-- {/if} --> 
        
        <!-- {if $action eq 'payment_password_close'} --> 
        <div class="s_b border-bt">
          <h5 class="user-title user-title-t"> 
          	<p> <span class="span_rank">关闭支付密码</span></p>
          </h5>
        <!-- 关闭支付密码 start-->
        <!-- {if $step eq 'step_1'} -->
        <div class="blank" ></div>
        <div id="find_pw" class="find_pw2">
          <div class="find_con">
            <div id="sflex04" class="stepflex stepflex_te">
              <dl class="first doing">
                <dt class="s-num">1</dt>
                <dd class="s-text"> 验证身份 <s></s> <b></b> </dd>
              </dl>
              <dl class="last">
                <dt class="s-num">&nbsp;</dt>
                <dd class="s-text"> 完成 <s></s> <b></b> </dd>
              </dl>
            </div>
            <div id="find-box" class="uc_box">
              <form action="security.php" method="post" id="fpForm" name="fpForm">
                <div id="error_container"></div>
                <div class="item">
                  <label class="con_un">验证身份方式：</label>
                  <select id="validate_type" name="validate_type">
                    <!-- {foreach from=$validate_types item=item} -->
                    <option id="validate_type_{$item.type}" value="{$item.type}" val="{$item.value}">{$item.name}</option>
                    <!-- {/foreach} -->
                  </select>
                </div>
                <div class="item v_mobile_phone v_item" style="display: none">
                  <label class="con_un">手机号：</label>
                  <span id="l_mobile_phone"></span> </div>
                <div id="c_mobile_code" class="item v_mobile_phone v_item" style="display: none">
                  <label class="con_un">手机验证码：</label>
                  <input type="text" id="mobile_code" name="mobile_code" class="text text_te2" value="" />
                  <input id="zphone" type="button" value="获取手机验证码" class="code" />
                </div>
                <div class="item v_email v_item" style="display: none">
                  <label class="con_un">邮箱地址：</label>
                  <span id="l_email"></span> </div>
                <div id="c_email" class="item v_email v_item" style="display: none">
                  <label class="con_un">邮箱验证码：</label>
                  <input type="text" id="email_code" name="email_code" class="text text_te2" value="" />
                  <input id="zemail" type="button" value="获取邮箱验证码" class="code" />
                </div>
                <div class="item v_password v_item" style="display: none">
                  <label class="con_un">用户名：</label>
                  <span id="l_password"></span> </div>
                <div id="c_password" class="item v_password v_item" style="display: none">
                  <label class="con_un">登录密码：</label>
                  <input type="password" id="password" name="password" class="text text_te2" value="" />
                </div>
                <div class="item">
                  <label class="con_un">验证码：</label>
                  <input type="text" id="captcha" size="8" name="captcha" class="text text_te" placeholder="{$lang.comment_captcha}" style="ime-mode: disabled" autocomplete="off" MaxLength="6" />
                  <label class="img" style="margin-left: 5px"> <img src="captcha.php?{$rand}" alt="captcha" style="vertical-align: middle; cursor: pointer;" onClick="this.src='captcha.php?'+Math.random();$('#captcha').focus();" /> </label>
                </div>
                <div class="item" style="text-align:center">
                  <input type="hidden" name="act" value="do_payment_password_close" />
                  <input type="button" name="button" id="btn_submit" class="btn_next" value="提 交" />
                </div>
              </form>
            </div>
          </div>
          <script type="text/javascript">
								function show_validate_type(validate_type_obj){
									var type = $(validate_type_obj).val();
									var value = $("#validate_type_"+type).attr("val");
									$("#l_"+type).html(value);
									$(".v_item").hide();
									$(".v_"+type).show();
								}
								
								function send_email_code(emailCodeObj, sendButton){
									// 发送邮件
									var url = 'validate.php';
									$.post(url, {
										act: 'send_email_code'
									}, function(result) {
										if (result == 'ok') {
											//倒计时
											countdown(sendButton);
										} else {
											alert(result);
										}
									}, 'text');
								}
								
								function send_mobile_code(mobileCodeObj, sendButton) {
									// 发送邮件
									var url = 'validate.php';
									$.post(url, {
										act: 'send_mobile_code'
									}, function(result) {
										if (result == 'ok') {
											//倒计时
											countdown(sendButton);
										} else {
											alert(result);
										}
									}, 'text');
								}
								
								$().ready(function(){
									
									show_validate_type($("#validate_type"));
									
									var validator = $("#fpForm").validate({
										debug: false,
										rules: {
											mobile_code: {
												required: true
											},
											email_code: {
												required: true
											},
											captcha: {
												required: true
											}
										},
										messages: {
											mobile_code: {
												required: "请输入手机验证码"
											},
											email_code: {
												required: "请输入邮箱验证码"
											},
											captcha: {
												required: "请输入验证码"
											}
										},
										errorPlacement: function(error, element) {
											error.appendTo(element.parent());  
										}
									});
									
									$("#validate_type").change(function(){
										show_validate_type($(this));
									});
									
									$("#zphone").click(function(){
										send_mobile_code($("#mobile_code"), $(this));
									});
									
									$("#zemail").click(function(){
										send_email_code($("#email_code"), $(this));
									});
									
									$("#btn_submit").click(function(){
										
										if(!validator.form()){
											return;
										}
										
										var type = $("#validate_type").val();
										
										var url = "security.php";
										var validate_type = $("#validate_type").val();
										$.post(url, {act: "validate", mobile_code: $("#mobile_code").val(), email_code: $("#email_code").val(), password: $("#password").val(), validate_type: validate_type, captcha: $("#captcha").val()}, function(data){
											if(data.error == 1){
												alert(data.content);
												if(data.url != undefined && data.url.length > 0){
													window.location.href = data.url;
												}
											}else{
												$("#fpForm").submit();
											}
										}, "json");
									});
									
								});
							</script> 
        </div>
        <!-- {/if} --> 
        <!-- {if $step eq 'step_2'} -->
        <div class="blank"></div>
        <div id="find_pw3">
          <div class="find_con">
            <div id="sflex04" class="stepflex stepflex_te">
              <dl class="first done">
                <dt class="s-num">1</dt>
                <dd class="s-text"> 验证身份 <s></s> <b></b> </dd>
              </dl>
              <dl class="last doing">
                <dt class="s-num">&nbsp;</dt>
                <dd class="s-text"> 完成 <s></s> <b></b> </dd>
              </dl>
            </div>
            <div id="find-box" class="uc_box">
              <div class="find_box_end">
                <p> <i></i> 关闭支付密码成功！ </p>
                <p class="on_go"> <a href="security.php" title="立即购物" class="back">返回账户安全中心&gt;&gt;</a> </p>
              </div>
            </div>
          </div>
        </div>
        <!-- {/if} --> 
        <!-- 关闭支付密码 end --> 
        </div>
        <!-- {/if} --> 
    </section>
  </div>
</div>
<!-- #BeginLibraryItem "/library/page_footer.lbi" --><!-- #EndLibraryItem --> <!-- #BeginLibraryItem "/library/footer_nav.lbi" --><!-- #EndLibraryItem -->
</body>
</html>
